<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saurshakti Hybrid Energy</title>
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Saurshakti Energy">
    <meta name="application-name" content="Saurshakti Energy">
    <meta name="msapplication-TileColor" content="#2563eb">
    <meta name="msapplication-config" content="none">
    
    <!-- Enhanced PWA Manifest -->
    <link rel="manifest" id="manifest-placeholder">
    
    <!-- Multiple Icon Sizes for Better Compatibility -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0ODggNDg4Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNDg4IiBoZWlnaHQ9IjQ4OCIgZmlsbD0iIzI1NjNlYiIvPjx0ZXh0IHg9IjI0NCIgeT0iMjgwIiBmb250LWZhbWlseT0iQXJpYWwiIGZvbnQtc2l6ZT0iMTgwIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+U0U8L3RleHQ+PC9zdmc+">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0ODggNDg4Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNDg4IiBoZWlnaHQ9IjQ4OCIgZmlsbD0iIzI1NjNlYiIgcng9IjgwIi8+PHRleHQgeD0iMjQ0IiB5PSIyODAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxODAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TRTwvdGV4dD48L3N2Zz4=">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        .pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Install App Banner -->
    <div id="installBanner" class="bg-blue-600 text-white p-3 text-center hidden">
        <div class="flex items-center justify-between max-w-7xl mx-auto">
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm">Install this app on your phone for better experience!</span>
            </div>
            <div class="flex space-x-2">
                <button id="installBtn" class="bg-white text-blue-600 px-3 py-1 rounded text-sm font-semibold">
                    Install
                </button>
                <button id="dismissInstall" class="text-blue-200 hover:text-white px-2">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center">
                    <div class="bg-blue-600 p-2 rounded-lg mr-3">
                        <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-bold text-gray-900">Saurshakti Hybrid Energy</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="manualInstallBtn" class="bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded-lg text-sm transition-colors pulse">
                        📱 Install App
                    </button>
                    <span id="currentUser" class="text-sm text-gray-600"></span>
                    <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Login Screen -->
        <div id="loginScreen" class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-8">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-gray-900 mb-2">Welcome</h2>
                <p class="text-gray-600">Select your role to continue</p>
            </div>
            
            <div class="space-y-4">
                <button onclick="showLogin('admin')" class="w-full bg-purple-600 hover:bg-purple-700 text-white py-3 px-6 rounded-lg font-semibold transition-colors">
                    Admin Login
                </button>
                <button onclick="showLogin('electrician')" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-6 rounded-lg font-semibold transition-colors">
                    Electrician Login
                </button>
                <button onclick="showRegistration()" class="w-full bg-green-600 hover:bg-green-700 text-white py-3 px-6 rounded-lg font-semibold transition-colors">
                    New Electrician Registration
                </button>
            </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="max-w-md mx-auto bg-white rounded-xl shadow-lg p-8 hidden">
            <h2 id="loginTitle" class="text-2xl font-bold text-gray-900 mb-6 text-center"></h2>
            <form onsubmit="handleLogin(event)">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Mobile Number</label>
                    <input type="tel" id="loginMobile" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors">
                    Login
                </button>
                <button type="button" onclick="showLoginScreen()" class="w-full mt-2 text-gray-600 hover:text-gray-800 py-2">
                    Back
                </button>
            </form>
        </div>

        <!-- Registration Form -->
        <div id="registrationForm" class="max-w-2xl mx-auto bg-white rounded-xl shadow-lg p-8 hidden">
            <h2 class="text-2xl font-bold text-gray-900 mb-6 text-center">Electrician Registration</h2>
            <form onsubmit="handleRegistration(event)">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Full Name *</label>
                        <input type="text" id="regName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Mobile Number *</label>
                        <input type="tel" id="regMobile" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Bank Account Number *</label>
                        <input type="text" id="regBankAccount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">IFSC Code *</label>
                        <input type="text" id="regIFSC" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Aadhar Document *</label>
                        <input type="file" id="regAadhar" accept="image/*,.pdf" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">PAN Document *</label>
                        <input type="file" id="regPAN" accept="image/*,.pdf" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Password *</label>
                        <input type="password" id="regPassword" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                    </div>
                </div>
                <div class="mt-6 flex space-x-4">
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors">
                        Register
                    </button>
                    <button type="button" onclick="showLoginScreen()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold transition-colors">
                        Back
                    </button>
                </div>
            </form>
        </div>

        <!-- Admin Dashboard -->
        <div id="adminDashboard" class="hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Pending Registrations -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Pending Registrations</h3>
                    <div id="pendingRegistrations" class="space-y-4">
                        <!-- Pending registrations will be populated here -->
                    </div>
                </div>

                <!-- Redeem Requests -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Redeem Requests</h3>
                    <div id="redeemRequests" class="space-y-4">
                        <!-- Redeem requests will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Customer Details -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">All Customer Details</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Date</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Customer</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Mobile</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Consumer No</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Service</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Amount</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Electrician</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Action</th>
                            </tr>
                        </thead>
                        <tbody id="allCustomerDetails">
                            <!-- All customer details will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Approved Electricians -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">Approved Electricians</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Name</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Mobile</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Points</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Customers</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Status</th>
                            </tr>
                        </thead>
                        <tbody id="approvedElectricians">
                            <!-- Approved electricians will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Electrician Dashboard -->
        <div id="electricianDashboard" class="hidden fade-in">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Stats Cards -->
                <div class="lg:col-span-3 grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100">Total Points</p>
                                <p id="totalPoints" class="text-3xl font-bold">0</p>
                            </div>
                            <div class="bg-blue-400 p-3 rounded-full">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl shadow-lg p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100">Customers Added</p>
                                <p id="totalCustomers" class="text-3xl font-bold">0</p>
                            </div>
                            <div class="bg-green-400 p-3 rounded-full">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100">Account Status</p>
                                <p id="accountStatus" class="text-xl font-bold">Pending</p>
                            </div>
                            <div class="bg-purple-400 p-3 rounded-full">
                                <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Customer Form -->
                <div class="lg:col-span-2 bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Add New Customer</h3>
                    <form id="customerForm" onsubmit="handleCustomerForm(event)">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Customer Name *</label>
                                <input type="text" id="customerName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Mobile Number *</label>
                                <input type="tel" id="customerMobile" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Consumer Number *</label>
                                <input type="text" id="consumerNumber" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Service Amount (₹) *</label>
                                <input type="number" id="serviceAmount" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 text-sm font-bold mb-2">Address *</label>
                                <textarea id="customerAddress" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required></textarea>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Service Type *</label>
                                <select id="serviceType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                                    <option value="">Select Service</option>
                                    <option value="Solar Installation">Solar Installation</option>
                                    <option value="Solar Maintenance">Solar Maintenance</option>
                                    <option value="Inverter Repair">Inverter Repair</option>
                                    <option value="Battery Service">Battery Service</option>
                                    <option value="Wiring">Wiring</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Document 1 *</label>
                                <input type="file" id="customerDoc1" accept="image/*,.pdf" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 text-sm font-bold mb-2">Document 2 *</label>
                                <input type="file" id="customerDoc2" accept="image/*,.pdf" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required>
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-gray-700 text-sm font-bold mb-2">Service Description *</label>
                                <textarea id="serviceDescription" rows="4" placeholder="Describe the work done, materials used, etc." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" required></textarea>
                            </div>
                        </div>
                        <button type="submit" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white py-2 px-6 rounded-lg font-semibold transition-colors">
                            Add Customer (+15 Points)
                        </button>
                    </form>
                </div>

                <!-- Redeem Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Redeem Points</h3>
                    <div class="space-y-4">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <h4 class="font-semibold text-yellow-800">Redeem Policy</h4>
                            <div class="mt-2 space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Cash Reward</span>
                                    <span class="text-sm font-bold">₹1500</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Required Points</span>
                                    <span class="text-sm font-bold">15 Points</span>
                                </div>
                                <p class="text-xs text-yellow-700 mt-2">
                                    * You can only redeem when you have exactly 15 points
                                </p>
                                <p class="text-xs text-yellow-700">
                                    * All 15 points will be used for ₹1500 cash
                                </p>
                            </div>
                        </div>
                        <button onclick="requestRedeem()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-semibold transition-colors">
                            Redeem 15 Points for ₹1500
                        </button>
                    </div>
                </div>
            </div>

            <!-- Customer History -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">My Customers</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full table-auto">
                        <thead>
                            <tr class="bg-gray-50">
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Date</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Customer</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Mobile</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Consumer No</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Service</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Amount</th>
                                <th class="px-4 py-2 text-left text-sm font-semibold text-gray-900">Points</th>
                            </tr>
                        </thead>
                        <tbody id="customerHistory">
                            <!-- Customer history will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Detail Modal -->
    <div id="customerModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-lg max-w-2xl w-full max-h-screen overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">Customer Details</h3>
                        <button onclick="closeCustomerModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="customerModalContent">
                        <!-- Customer details will be populated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Installation Instructions Modal -->
    <div id="installModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-lg max-w-md w-full">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900">📱 Install App</h3>
                        <button onclick="closeInstallModal()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    
                    <div id="androidInstructions" class="space-y-4">
                        <h4 class="font-semibold text-gray-800">🤖 Android Installation:</h4>
                        
                        <div class="bg-green-50 p-3 rounded-lg mb-3">
                            <p class="text-sm text-green-800 font-semibold">
                                ✅ Method 1: Chrome Browser
                            </p>
                        </div>
                        
                        <ol class="list-decimal list-inside space-y-2 text-sm text-gray-600">
                            <li>Chrome browser में यह page खोलें</li>
                            <li>Address bar में 🔒 lock icon के पास install icon (⬇️) दिखेगा</li>
                            <li>Install icon पर tap करें</li>
                            <li>"Install" button पर tap करें</li>
                        </ol>
                        
                        <div class="bg-yellow-50 p-3 rounded-lg">
                            <p class="text-sm text-yellow-800 font-semibold">
                                📱 Method 2: Manual Steps
                            </p>
                            <ol class="list-decimal list-inside space-y-1 text-sm text-yellow-700 mt-2">
                                <li>Chrome menu (⋮) खोलें</li>
                                <li>"Add to Home screen" select करें</li>
                                <li>App name confirm करके "Add" करें</li>
                            </ol>
                        </div>
                        
                        <div class="bg-red-50 p-3 rounded-lg">
                            <p class="text-sm text-red-800">
                                <strong>⚠️ अगर option नहीं दिख रहा:</strong><br>
                                • Chrome को latest version (100+) पर update करें<br>
                                • Page को 2-3 बार refresh करें<br>
                                • Chrome Settings > Site Settings > Pop-ups allow करें<br>
                                • Incognito mode में try न करें
                            </p>
                        </div>
                    </div>
                    
                    <div id="iosInstructions" class="space-y-4 mt-6">
                        <h4 class="font-semibold text-gray-800">🍎 iPhone (Safari):</h4>
                        <ol class="list-decimal list-inside space-y-2 text-sm text-gray-600">
                            <li>Safari browser में यह page खोलें</li>
                            <li>Bottom में Share button (📤) tap करें</li>
                            <li>"Add to Home Screen" select करें</li>
                            <li>App name confirm करके "Add" करें</li>
                        </ol>
                        
                        <div class="bg-green-50 p-3 rounded-lg">
                            <p class="text-sm text-green-800">
                                <strong>Important:</strong> Chrome नहीं, Safari browser जरूर use करें!
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-6 space-y-3">
                        <button onclick="copyCurrentURL()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg transition-colors">
                            📋 Copy Link (WhatsApp पर भेजने के लिए)
                        </button>
                        <button onclick="showQRCode()" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg transition-colors">
                            📱 QR Code दिखाएं
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- QR Code Modal -->
    <div id="qrModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-lg max-w-sm w-full text-center p-6">
                <h3 class="text-xl font-bold text-gray-900 mb-4">📱 QR Code Scan करें</h3>
                <div id="qrCodeContainer" class="bg-gray-100 p-4 rounded-lg mb-4">
                    <!-- QR Code will be generated here -->
                </div>
                <p class="text-sm text-gray-600 mb-4">Mobile camera से scan करके app install करें</p>
                <button onclick="closeQRModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- Notifications -->
    <div id="notifications" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // Global state
        let currentUser = null;
        let currentRole = null;
        let electricians = JSON.parse(localStorage.getItem('electricians') || '[]');
        let customers = JSON.parse(localStorage.getItem('customers') || '[]');
        let redeemRequests = JSON.parse(localStorage.getItem('redeemRequests') || '[]');
        
        // PWA Installation
        let deferredPrompt;
        let installButton = null;

        // Initialize admin user if not exists
        if (!electricians.find(e => e.mobile === '9999999999' && e.role === 'admin')) {
            electricians.push({
                id: 'admin-1',
                name: 'Admin',
                mobile: '9999999999',
                password: 'admin123',
                role: 'admin',
                approved: true,
                points: 0,
                customers: []
            });
            localStorage.setItem('electricians', JSON.stringify(electricians));
        }

        // Generate and inject PWA manifest
        function generateManifest() {
            const manifest = {
                "name": "Saurshakti Hybrid Energy",
                "short_name": "Saurshakti",
                "description": "Electrician Management System for Solar Energy Services",
                "start_url": window.location.href,
                "display": "standalone",
                "background_color": "#2563eb",
                "theme_color": "#2563eb",
                "orientation": "portrait-primary",
                "scope": "/",
                "lang": "hi",
                "categories": ["business", "productivity"],
                "icons": [
                    {
                        "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0ODggNDg4Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNDg4IiBoZWlnaHQ9IjQ4OCIgZmlsbD0iIzI1NjNlYiIgcng9IjgwIi8+PHRleHQgeD0iMjQ0IiB5PSIyODAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxODAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TRTwvdGV4dD48L3N2Zz4=",
                        "sizes": "192x192",
                        "type": "image/svg+xml",
                        "purpose": "any maskable"
                    },
                    {
                        "src": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0ODggNDg4Ij48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iNDg4IiBoZWlnaHQ9IjQ4OCIgZmlsbD0iIzI1NjNlYiIgcng9IjgwIi8+PHRleHQgeD0iMjQ0IiB5PSIyODAiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxODAiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5TRTwvdGV4dD48L3N2Zz4=",
                        "sizes": "512x512",
                        "type": "image/svg+xml",
                        "purpose": "any maskable"
                    }
                ]
            };
            
            const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
            const manifestURL = URL.createObjectURL(manifestBlob);
            
            const manifestLink = document.getElementById('manifest-placeholder');
            manifestLink.href = manifestURL;
        }

        // PWA Installation Functions
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('beforeinstallprompt fired');
            e.preventDefault();
            deferredPrompt = e;
            showInstallBanner();
        });

        function showInstallBanner() {
            const banner = document.getElementById('installBanner');
            banner.classList.remove('hidden');
            
            document.getElementById('installBtn').addEventListener('click', installApp);
            document.getElementById('dismissInstall').addEventListener('click', () => {
                banner.classList.add('hidden');
            });
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        showNotification('App installed successfully! 🎉');
                    }
                    deferredPrompt = null;
                    document.getElementById('installBanner').classList.add('hidden');
                });
            } else {
                showInstallModal();
            }
        }

        function showInstallModal() {
            document.getElementById('installModal').classList.remove('hidden');
        }

        function closeInstallModal() {
            document.getElementById('installModal').classList.add('hidden');
        }

        function copyCurrentURL() {
            const url = window.location.href;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Link copied! WhatsApp पर share करें 📱');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Link copied! WhatsApp पर share करें 📱');
            });
        }

        function showQRCode() {
            const url = window.location.href;
            const qrContainer = document.getElementById('qrCodeContainer');
            
            // Simple QR code using Google Charts API
            const qrCodeURL = `https://chart.googleapis.com/chart?chs=200x200&cht=qr&chl=${encodeURIComponent(url)}`;
            qrContainer.innerHTML = `<img src="${qrCodeURL}" alt="QR Code" class="mx-auto">`;
            
            document.getElementById('qrModal').classList.remove('hidden');
        }

        function closeQRModal() {
            document.getElementById('qrModal').classList.add('hidden');
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification px-6 py-4 rounded-lg shadow-lg text-white ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            notification.textContent = message;
            
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function hideAllScreens() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registrationForm').classList.add('hidden');
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('electricianDashboard').classList.add('hidden');
        }

        function showLoginScreen() {
            hideAllScreens();
            document.getElementById('loginScreen').classList.remove('hidden');
        }

        function showLogin(role) {
            hideAllScreens();
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginTitle').textContent = role === 'admin' ? 'Admin Login' : 'Electrician Login';
            currentRole = role;
        }

        function showRegistration() {
            hideAllScreens();
            document.getElementById('registrationForm').classList.remove('hidden');
        }

        // Authentication functions
        function handleLogin(event) {
            event.preventDefault();
            const mobile = document.getElementById('loginMobile').value;
            const password = document.getElementById('loginPassword').value;

            const user = electricians.find(e => 
                e.mobile === mobile && 
                e.password === password && 
                e.role === currentRole
            );

            if (!user) {
                showNotification('Invalid credentials!', 'error');
                return;
            }

            if (currentRole === 'electrician' && !user.approved) {
                showNotification('Your account is pending approval!', 'error');
                return;
            }

            currentUser = user;
            document.getElementById('currentUser').textContent = `${user.name} (${user.role})`;
            
            if (currentRole === 'admin') {
                showAdminDashboard();
            } else {
                showElectricianDashboard();
            }

            showNotification(`Welcome ${user.name}!`);
        }

        function handleRegistration(event) {
            event.preventDefault();
            
            const formData = {
                id: 'elec-' + Date.now(),
                name: document.getElementById('regName').value,
                mobile: document.getElementById('regMobile').value,
                bankAccount: document.getElementById('regBankAccount').value,
                ifsc: document.getElementById('regIFSC').value,
                password: document.getElementById('regPassword').value,
                role: 'electrician',
                approved: false,
                points: 0,
                customers: [],
                documents: {
                    aadhar: document.getElementById('regAadhar').files[0]?.name || 'uploaded',
                    pan: document.getElementById('regPAN').files[0]?.name || 'uploaded'
                },
                registrationDate: new Date().toLocaleDateString()
            };

            // Check if mobile already exists
            if (electricians.find(e => e.mobile === formData.mobile)) {
                showNotification('Mobile number already registered!', 'error');
                return;
            }

            electricians.push(formData);
            localStorage.setItem('electricians', JSON.stringify(electricians));
            
            showNotification('Registration successful! Wait for admin approval.');
            showLoginScreen();
        }

        function logout() {
            currentUser = null;
            currentRole = null;
            document.getElementById('currentUser').textContent = '';
            showLoginScreen();
        }

        // Admin functions
        function showAdminDashboard() {
            hideAllScreens();
            document.getElementById('adminDashboard').classList.remove('hidden');
            loadPendingRegistrations();
            loadRedeemRequests();
            loadAllCustomerDetails();
            loadApprovedElectricians();
        }

        function loadPendingRegistrations() {
            const pending = electricians.filter(e => e.role === 'electrician' && !e.approved);
            const container = document.getElementById('pendingRegistrations');
            
            if (pending.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No pending registrations</p>';
                return;
            }

            container.innerHTML = pending.map(elec => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-semibold text-gray-900">${elec.name}</h4>
                            <p class="text-sm text-gray-600">Mobile: ${elec.mobile}</p>
                            <p class="text-sm text-gray-600">Bank: ${elec.bankAccount} (${elec.ifsc})</p>
                            <p class="text-sm text-gray-600">Registered: ${elec.registrationDate}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="approveElectrician('${elec.id}')" 
                                class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                Approve
                            </button>
                            <button onclick="rejectElectrician('${elec.id}')" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                Reject
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadRedeemRequests() {
            const container = document.getElementById('redeemRequests');
            
            if (redeemRequests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No redeem requests</p>';
                return;
            }

            container.innerHTML = redeemRequests.map(req => {
                const electrician = electricians.find(e => e.id === req.electricianId);
                return `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900">${electrician?.name}</h4>
                        <p class="text-sm text-gray-600">Reward: ₹${req.amount}</p>
                        <p class="text-sm text-gray-600">Points: ${req.points}</p>
                        <p class="text-sm text-gray-600">Date: ${req.date}</p>
                        <div class="mt-2 flex space-x-2">
                            <button onclick="approveRedeem('${req.id}')" 
                                class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                Approve
                            </button>
                            <button onclick="rejectRedeem('${req.id}')" 
                                class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                Reject
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAllCustomerDetails() {
            const tbody = document.getElementById('allCustomerDetails');
            
            if (customers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center text-gray-500">No customers added yet</td></tr>';
                return;
            }

            tbody.innerHTML = customers.map(customer => {
                const electrician = electricians.find(e => e.id === customer.electricianId);
                return `
                    <tr class="border-b border-gray-200">
                        <td class="px-4 py-2">${customer.date}</td>
                        <td class="px-4 py-2">${customer.name}</td>
                        <td class="px-4 py-2">${customer.mobile}</td>
                        <td class="px-4 py-2">${customer.consumerNumber}</td>
                        <td class="px-4 py-2">${customer.serviceType}</td>
                        <td class="px-4 py-2">₹${customer.amount}</td>
                        <td class="px-4 py-2">${electrician?.name || 'Unknown'}</td>
                        <td class="px-4 py-2">
                            <button onclick="viewCustomerDetails('${customer.id}')" 
                                class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                View Details
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadApprovedElectricians() {
            const approved = electricians.filter(e => e.role === 'electrician' && e.approved);
            const tbody = document.getElementById('approvedElectricians');
            
            tbody.innerHTML = approved.map(elec => `
                <tr class="border-b border-gray-200">
                    <td class="px-4 py-2">${elec.name}</td>
                    <td class="px-4 py-2">${elec.mobile}</td>
                    <td class="px-4 py-2">${elec.points}</td>
                    <td class="px-4 py-2">${elec.customers.length}</td>
                    <td class="px-4 py-2">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Active</span>
                    </td>
                </tr>
            `).join('');
        }

        function viewCustomerDetails(customerId) {
            const customer = customers.find(c => c.id === customerId);
            const electrician = electricians.find(e => e.id === customer.electricianId);
            
            if (!customer) return;

            const modalContent = document.getElementById('customerModalContent');
            modalContent.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-2">Customer Information</h4>
                        <p><strong>Name:</strong> ${customer.name}</p>
                        <p><strong>Mobile:</strong> ${customer.mobile}</p>
                        <p><strong>Consumer No:</strong> ${customer.consumerNumber}</p>
                        <p><strong>Address:</strong> ${customer.address}</p>
                        <p><strong>Date:</strong> ${customer.date}</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-2">Service Information</h4>
                        <p><strong>Service Type:</strong> ${customer.serviceType}</p>
                        <p><strong>Amount:</strong> ₹${customer.amount}</p>
                        <p><strong>Electrician:</strong> ${electrician?.name || 'Unknown'}</p>
                        <p><strong>Electrician Mobile:</strong> ${electrician?.mobile || 'N/A'}</p>
                    </div>
                    <div class="md:col-span-2">
                        <h4 class="font-semibold text-gray-900 mb-2">Service Description</h4>
                        <p class="bg-gray-50 p-3 rounded-lg">${customer.description}</p>
                    </div>
                    <div class="md:col-span-2">
                        <h4 class="font-semibold text-gray-900 mb-2">Documents</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm font-medium">Document 1:</p>
                                <p class="text-sm text-gray-600">${customer.documents?.doc1 || 'Not uploaded'}</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm font-medium">Document 2:</p>
                                <p class="text-sm text-gray-600">${customer.documents?.doc2 || 'Not uploaded'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('customerModal').classList.remove('hidden');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.add('hidden');
        }

        function approveElectrician(id) {
            const electrician = electricians.find(e => e.id === id);
            if (electrician) {
                electrician.approved = true;
                localStorage.setItem('electricians', JSON.stringify(electricians));
                showNotification(`${electrician.name} approved successfully!`);
                loadPendingRegistrations();
                loadApprovedElectricians();
            }
        }

        function rejectElectrician(id) {
            const index = electricians.findIndex(e => e.id === id);
            if (index !== -1) {
                const name = electricians[index].name;
                electricians.splice(index, 1);
                localStorage.setItem('electricians', JSON.stringify(electricians));
                showNotification(`${name} registration rejected!`);
                loadPendingRegistrations();
            }
        }

        function approveRedeem(requestId) {
            const request = redeemRequests.find(r => r.id === requestId);
            const electrician = electricians.find(e => e.id === request.electricianId);
            
            if (request && electrician) {
                // Add approval notification for electrician
                if (!electrician.notifications) {
                    electrician.notifications = [];
                }
                electrician.notifications.push({
                    id: 'notif-' + Date.now(),
                    type: 'redeem_approved',
                    message: `Your redeem request of ₹${request.amount} has been approved!`,
                    date: new Date().toLocaleDateString(),
                    read: false
                });
                
                // Remove the request
                const index = redeemRequests.findIndex(r => r.id === requestId);
                redeemRequests.splice(index, 1);
                
                localStorage.setItem('electricians', JSON.stringify(electricians));
                localStorage.setItem('redeemRequests', JSON.stringify(redeemRequests));
                
                showNotification(`₹${request.amount} reward approved for ${electrician.name}!`);
                loadRedeemRequests();
                loadApprovedElectricians();
            }
        }

        function rejectRedeem(requestId) {
            const request = redeemRequests.find(r => r.id === requestId);
            const electrician = electricians.find(e => e.id === request.electricianId);
            
            if (request && electrician) {
                // Delete the last customer added by this electrician
                const electricianCustomers = customers.filter(c => c.electricianId === electrician.id);
                if (electricianCustomers.length > 0) {
                    // Remove the most recent customer
                    const lastCustomer = electricianCustomers[electricianCustomers.length - 1];
                    const customerIndex = customers.findIndex(c => c.id === lastCustomer.id);
                    customers.splice(customerIndex, 1);
                    
                    // Remove customer from electrician's customer list
                    const custIdIndex = electrician.customers.findIndex(id => id === lastCustomer.id);
                    electrician.customers.splice(custIdIndex, 1);
                }
                
                // Points remain 0 (no return)
                electrician.points = 0;
                
                // Add rejection notification for electrician
                if (!electrician.notifications) {
                    electrician.notifications = [];
                }
                electrician.notifications.push({
                    id: 'notif-' + Date.now(),
                    type: 'redeem_rejected',
                    message: `Your redeem request was rejected. Your last customer details have been deleted. Please re-enter customer information to earn points again.`,
                    date: new Date().toLocaleDateString(),
                    read: false
                });
                
                // Remove the request
                const index = redeemRequests.findIndex(r => r.id === requestId);
                redeemRequests.splice(index, 1);
                
                localStorage.setItem('customers', JSON.stringify(customers));
                localStorage.setItem('electricians', JSON.stringify(electricians));
                localStorage.setItem('redeemRequests', JSON.stringify(redeemRequests));
                
                showNotification(`Redeem request rejected! Customer details deleted for ${electrician.name}.`);
                loadRedeemRequests();
                loadApprovedElectricians();
                loadAllCustomerDetails();
            }
        }

        // Electrician functions
        function showElectricianDashboard() {
            hideAllScreens();
            document.getElementById('electricianDashboard').classList.remove('hidden');
            updateElectricianStats();
            loadCustomerHistory();
            checkNotifications();
        }

        function checkNotifications() {
            if (currentUser.notifications && currentUser.notifications.length > 0) {
                const unreadNotifications = currentUser.notifications.filter(n => !n.read);
                unreadNotifications.forEach(notification => {
                    showNotification(notification.message, 'info');
                    notification.read = true;
                });
                
                // Update user in electricians array
                const electricianIndex = electricians.findIndex(e => e.id === currentUser.id);
                electricians[electricianIndex] = currentUser;
                localStorage.setItem('electricians', JSON.stringify(electricians));
            }
        }

        function updateElectricianStats() {
            document.getElementById('totalPoints').textContent = currentUser.points;
            document.getElementById('totalCustomers').textContent = currentUser.customers.length;
            document.getElementById('accountStatus').textContent = currentUser.approved ? 'Approved' : 'Pending';
        }

        function handleCustomerForm(event) {
            event.preventDefault();
            
            const customerData = {
                id: 'cust-' + Date.now(),
                name: document.getElementById('customerName').value,
                mobile: document.getElementById('customerMobile').value,
                consumerNumber: document.getElementById('consumerNumber').value,
                address: document.getElementById('customerAddress').value,
                serviceType: document.getElementById('serviceType').value,
                amount: parseInt(document.getElementById('serviceAmount').value),
                description: document.getElementById('serviceDescription').value,
                date: new Date().toLocaleDateString(),
                electricianId: currentUser.id,
                documents: {
                    doc1: document.getElementById('customerDoc1').files[0]?.name || 'uploaded',
                    doc2: document.getElementById('customerDoc2').files[0]?.name || 'uploaded'
                }
            };

            // Add customer to global customers array
            customers.push(customerData);
            
            // Add customer to electrician's customers array
            currentUser.customers.push(customerData.id);
            
            // Add 15 points to electrician
            currentUser.points += 15;
            
            // Update electrician in the main array
            const electricianIndex = electricians.findIndex(e => e.id === currentUser.id);
            electricians[electricianIndex] = currentUser;
            
            // Save to localStorage
            localStorage.setItem('customers', JSON.stringify(customers));
            localStorage.setItem('electricians', JSON.stringify(electricians));
            
            showNotification('Customer added successfully! +15 points earned!');
            
            // Reset form
            document.getElementById('customerForm').reset();
            
            // Update dashboard
            updateElectricianStats();
            loadCustomerHistory();
        }

        function loadCustomerHistory() {
            const userCustomers = customers.filter(c => c.electricianId === currentUser.id);
            const tbody = document.getElementById('customerHistory');
            
            if (userCustomers.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" class="px-4 py-8 text-center text-gray-500">No customers added yet</td></tr>';
                return;
            }

            tbody.innerHTML = userCustomers.map(customer => `
                <tr class="border-b border-gray-200">
                    <td class="px-4 py-2">${customer.date}</td>
                    <td class="px-4 py-2">${customer.name}</td>
                    <td class="px-4 py-2">${customer.mobile}</td>
                    <td class="px-4 py-2">${customer.consumerNumber}</td>
                    <td class="px-4 py-2">${customer.serviceType}</td>
                    <td class="px-4 py-2">₹${customer.amount}</td>
                    <td class="px-4 py-2">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">+15</span>
                    </td>
                </tr>
            `).join('');
        }

        function requestRedeem() {
            if (currentUser.points < 15) {
                showNotification('You need at least 15 points to redeem!', 'error');
                return;
            }

            // Check if user already has a pending redeem request
            const existingRequest = redeemRequests.find(r => r.electricianId === currentUser.id && r.status === 'pending');
            if (existingRequest) {
                showNotification('You already have a pending redeem request!', 'error');
                return;
            }

            const request = {
                id: 'redeem-' + Date.now(),
                electricianId: currentUser.id,
                points: 15,
                amount: 1500,
                date: new Date().toLocaleDateString(),
                status: 'pending'
            };

            // Deduct points immediately
            currentUser.points = 0;
            
            // Update electrician in the main array
            const electricianIndex = electricians.findIndex(e => e.id === currentUser.id);
            electricians[electricianIndex] = currentUser;
            
            // Add request
            redeemRequests.push(request);
            
            // Save to localStorage
            localStorage.setItem('electricians', JSON.stringify(electricians));
            localStorage.setItem('redeemRequests', JSON.stringify(redeemRequests));
            
            showNotification('Redeem request sent! Your points have been deducted. Wait for admin approval.');
            updateElectricianStats();
        }

        // Event listeners
        document.getElementById('logoutBtn').addEventListener('click', logout);
        document.getElementById('manualInstallBtn').addEventListener('click', installApp);

        // Service Worker Registration
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'saurshakti-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => {
                                    return response || fetch(event.request);
                                })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('ServiceWorker registered successfully');
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed');
                    });
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            generateManifest();
            registerServiceWorker();
            showLoginScreen();
            
            // Force show install button for testing
            setTimeout(() => {
                if (!deferredPrompt) {
                    showInstallBanner();
                }
            }, 2000);
        });
        
        // Check if app is already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('manualInstallBtn').style.display = 'none';
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97b5d8f1b5909a5e',t:'MTc1NzI0NDM0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
